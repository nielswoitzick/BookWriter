$(function() {
  $('#dialog').html('<%= escape_javascript(render partial: 'autosave_chunk_list') %>');

  var dialog, form;
  var submitted = false;

  function recreate() {
    var valid = true;
    if (valid) {
      $.post(form.attr('action'), form.serialize(), null, 'json');
      dialog.dialog( "close" );
      alert('Textabschnitt wurde erfolgreich wiederhergestellt!');
    }
    return valid;
  }

  dialog = $("#dialog").dialog({
    autoOpen: false,
    height: 500,
    width: 750,
    modal: true,
    buttons: {
      "Wiederherstellen": recreate,
      Cancel: function() {
        dialog.dialog( "close" );
      }
    },
    close: function() {
      form[ 0 ].reset();
    }
  });

  form = dialog.find( "form" ).on( "submit", function( event ) {
    event.preventDefault();
    if (!submitted) {
      submitted = true;
      recreate();
    }
  });

  dialog.dialog( "open" );
});